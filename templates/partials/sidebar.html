{% set user_role = request.session.get("user_role") %}

<aside class="sidebar">
    <nav class="sidebar-nav">
        <a href="/dashboard" class="nav-item">
            <i class="fas fa-home"></i> Dashboard
        </a>
        
        {% if user_role == "manager_admin" %}
            <div class="nav-category">
                <div class="nav-category-header" onclick="toggleCategory(this)">
                    <i class="fas fa-key"></i> Tokenek
                    <i class="fas fa-chevron-down nav-category-icon"></i>
                </div>
                <div class="nav-category-content">
                    <a href="/tokens/generate" class="nav-item nav-sub-item">
                        <i class="fas fa-plus-circle"></i> Token generálás
                    </a>
                    <a href="/tokens/list" class="nav-item nav-sub-item">
                        <i class="fas fa-list"></i> Tokenek kezelése
                    </a>
                </div>
            </div>
            
            <div class="nav-category">
                <div class="nav-category-header" onclick="toggleCategory(this)">
                    <i class="fas fa-users"></i> Felhasználók
                    <i class="fas fa-chevron-down nav-category-icon"></i>
                </div>
                <div class="nav-category-content">
                    <a href="/admin/users" class="nav-item nav-sub-item">
                        <i class="fas fa-users"></i> Összes felhasználó
                    </a>
                </div>
            </div>
            
            <div class="nav-category">
                <div class="nav-category-header" onclick="toggleCategory(this)">
                    <i class="fas fa-bell"></i> Értesítések
                    <i class="fas fa-chevron-down nav-category-icon"></i>
                </div>
                <div class="nav-category-content">
                    <a href="/admin/notifications/create" class="nav-item nav-sub-item">
                        <i class="fas fa-edit"></i> Értesítés írása
                    </a>
                    <a href="/admin/update" class="nav-item nav-sub-item">
                        <i class="fas fa-sync-alt"></i> Manager Frissítés
                    </a>
                </div>
            </div>
            
            <div class="nav-category">
                <div class="nav-category-header" onclick="toggleCategory(this)">
                    <i class="fas fa-server"></i> Szerverkezelés
                    <i class="fas fa-chevron-down nav-category-icon"></i>
                </div>
                <div class="nav-category-content">
                    <a href="/admin/server/steamcmd" class="nav-item nav-sub-item">
                        <i class="fas fa-download"></i> SteamCMD
                    </a>
                </div>
            </div>
        {% endif %}
        
        {% if user_role in ["manager_admin", "server_admin"] %}
            <div class="nav-category">
                <div class="nav-category-header" onclick="toggleCategory(this)">
                    <i class="fas fa-user-shield"></i> Admin kezelés
                    <i class="fas fa-chevron-down nav-category-icon"></i>
                </div>
                <div class="nav-category-content">
                    <a href="/admin/list" class="nav-item nav-sub-item">
                        <i class="fas fa-list"></i> Admin felhasználók
                    </a>
                    <a href="/admin/create" class="nav-item nav-sub-item">
                        <i class="fas fa-user-plus"></i> Admin létrehozása
                    </a>
                </div>
            </div>
        {% endif %}
        
        {% if user_role in ["user", "admin", "server_admin"] %}
            <div class="nav-category">
                <div class="nav-category-header" onclick="toggleCategory(this)">
                    <i class="fas fa-ticket-alt"></i> Ticket rendszer
                    <i class="fas fa-chevron-down nav-category-icon"></i>
                </div>
                <div class="nav-category-content">
                    <a href="/tickets" class="nav-item nav-sub-item">
                        <i class="fas fa-list"></i> Ticketjeim
                    </a>
                    <a href="/tickets/create" class="nav-item nav-sub-item">
                        <i class="fas fa-plus-circle"></i> Új ticket
                    </a>
                </div>
            </div>
        {% endif %}
        
        {% if user_role == "manager_admin" %}
            <div class="nav-category">
                <div class="nav-category-header" onclick="toggleCategory(this)">
                    <i class="fas fa-headset"></i> Ticket kezelés
                    <i class="fas fa-chevron-down nav-category-icon"></i>
                </div>
                <div class="nav-category-content">
                    <a href="/admin/tickets" class="nav-item nav-sub-item">
                        <i class="fas fa-list"></i> Összes ticket
                    </a>
                </div>
            </div>
        {% endif %}
        
        {% if user_role in ["manager_admin", "server_admin", "admin"] %}
            <div class="nav-category">
                <div class="nav-category-header" onclick="toggleCategory(this)">
                    <i class="fas fa-comments"></i> Global Chat
                    <i class="fas fa-chevron-down nav-category-icon"></i>
                </div>
                <div class="nav-category-content">
                    <a href="/chat" class="nav-item nav-sub-item">
                        <i class="fas fa-comments"></i> Chat szobák
                    </a>
                </div>
            </div>
        {% endif %}
        
        <div class="nav-category">
            <div class="nav-category-header" onclick="toggleCategory(this)">
                <i class="fas fa-cog"></i> Beállítások
                <i class="fas fa-chevron-down nav-category-icon"></i>
            </div>
            <div class="nav-category-content">
                <a href="/tokens/activate" class="nav-item nav-sub-item">
                    <i class="fas fa-check-circle"></i> Token aktiválás
                </a>
                <a href="/settings/profile" class="nav-item nav-sub-item">
                    <i class="fas fa-user"></i> Profil módosítása
                </a>
                <a href="/settings/password" class="nav-item nav-sub-item">
                    <i class="fas fa-key"></i> Jelszó változtatás
                </a>
            </div>
        </div>
    </nav>
</aside>

<script>
function toggleCategory(header) {
    const category = header.parentElement;
    const isActive = category.classList.contains('active');
    
    // Bezárjuk az összes kategóriát
    document.querySelectorAll('.nav-category').forEach(cat => {
        cat.classList.remove('active');
    });
    
    // Ha nem volt aktív, akkor nyitjuk
    if (!isActive) {
        category.classList.add('active');
    }
}

// Alapértelmezett: első kategória nyitva
document.addEventListener('DOMContentLoaded', function() {
    const firstCategory = document.querySelector('.nav-category');
    if (firstCategory) {
        firstCategory.classList.add('active');
    }
    
    // Aktív oldal kiemelése
    const currentPath = window.location.pathname;
    document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
        if (item.getAttribute('href') === currentPath) {
            item.classList.add('active');
            // Szülő kategória is nyitva legyen
            const category = item.closest('.nav-category');
            if (category) {
                category.classList.add('active');
            }
        }
    });
});
</script>

